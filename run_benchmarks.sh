#!/bin/bash
# Set variables
export APEX_SCREEN_OUTPUT=1 APEX_CSV_OUTPUT=1
export HPXSC_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd )/dependencies"
export CMAKE_COMMAND=${HPXSC_ROOT}/build/cmake/bin/cmake
# Compile Code
rm -rf build && mkdir build && cd build && $CMAKE_COMMAND .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH="${HPXSC_ROOT}/build/hpx/build/lib/cmake/HPX" && make all
# Run both scripts for for each tiled-decomposition
cd ../benchmark_scripts
#CHOLESKY_VARIANTS="left right top"
CHOLESKY_VARIANTS="left"
LOOP=5
for CHOLESKY in $CHOLESKY_VARIANTS; do
  OUTPUT_FILE_CORES="cores_hpx_${CHOLESKY}.txt"
  OUTPUT_FILE_TILES="tiles_hpx_${CHOLESKY}.txt"
  OUTPUT_FILE_DATA="data_hpx_${CHOLESKY}.txt"
  rm $OUTPUT_FILE_CORES
  rm $OUTPUT_FILE_TILES
  rm $OUTPUT_FILE_DATA
  # Run cores_script
  START=1
  END=128
  STEP=2
  N_TRAIN=20000
  N_TEST=5000
  N_REG=100
  N_TILES=200
  #./cores_script.sh $START $END $STEP $N_TILES $N_TRAIN $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_CORES
  # Run tiles_script
  START=10
  END=10
  STEP=10
  N_TRAIN=10000
  N_TEST=5000
  N_REG=100
  ./tiles_script.sh $START $END $STEP $N_TRAIN $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_TILES
  START=100
  END=100
  ./tiles_script.sh $START $END $STEP $N_TRAIN $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_TILES
  # Run tiles_script
  START=25
  END=200
  STEP=2
  N_TRAIN=20000
  N_TEST=5000
  N_REG=100
  #./tiles_script.sh $START $END $STEP $N_TRAIN $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_TILES
  # Run data_script
  START=100
  END=900
  STEP=100
  N_TILES=1
  N_TEST=1000
  N_REG=100
  #./data_script.sh $START $END $STEP $N_TILES $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_DATA
  # Run data_script
  START=1000
  END=10000
  STEP=1000
  N_TILES=1
  N_TEST=1000
  N_REG=100
  #./data_script.sh $START $END $STEP $N_TILES $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_DATA
  # Run data_script
  START=10000
  END=100000
  STEP=10000
  N_TILES=200
  N_TEST=5000
  N_REG=100
  #./data_script.sh $START $END $STEP $N_TILES $N_TEST $N_REG $CHOLESKY $LOOP $OUTPUT_FILE_DATA
done
#left;6;1;20000;5000;100;2961160458;1924955582;1417499421;6269100;659330;0.004916   -> 2961 s 49 min
#left;128;1;20000;5000;100;2834970042;1840192389;1354272539;5910824;734831;0.004916 -> 2835 s 47 min

#left;128;10;50000;5000;100;4284093099;25855,574,437;38009,917,526;66004049;8682284;0.004673    -> 4284 s  71 min
#left;128;50;50000;5000;100;792536389;26575498311;68453180147;113520642;26785822;0.004673   -> 792 s 13 min
#left;128;100;50000;5000;100;385143933;25699940093;22382684536;19651936;36361963;0.004673   -> 385 s 7 min
#left;128;200;50000;5000;100;382,263,299;26,320,627,794;20,974,285,189;37638483;70373757;0.004673   -> 382 s


#left;128;50;100000;5000;100;6872,254,006;213,933,790,460;618,494,273,545;540271424;49728477;0.004567 -> ca 115 min
